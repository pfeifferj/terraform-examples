schemaVersion: 2.3.0
metadata:
  name: terraform-dev
  version: 1.0.0
  description: A devfile for Terraform development and testing.
  projectType: Infrastructure-as-Code
  language: HCL
  provider: Open Source
  tags: ['Terraform', 'IaC']
  displayName: Terraform Development Environment
  icon: https://www.terraform.io/assets/images/og-image-8b3e4f7d.png

components:
  - name: terraform
    container:
      image: hashicorp/terraform:latest
      memoryLimit: 512Mi
      cpuLimit: 1
      mountSources: true
      volumeMounts:
        - name: terraform-data
          path: /workspace

  - name: terraform-docs
    container:
      image: quay.io/terraform-docs/terraform-docs:latest
      memoryLimit: 128Mi
      cpuLimit: "0.5"
      mountSources: true
      volumeMounts:
        - name: terraform-data
          path: /workspace

  - name: terraform-lint
    container:
      image: ghcr.io/terraform-linters/tflint:latest
      memoryLimit: 128Mi
      cpuLimit: "0.5"
      mountSources: true
      volumeMounts:
        - name: terraform-data
          path: /workspace

commands:
  - id: terraform-init
    exec:
      component: terraform
      commandLine: "terraform init"
      workingDir: /workspace
      group:
        kind: build
        isDefault: true

  - id: terraform-plan
    exec:
      component: terraform
      commandLine: "terraform plan"
      workingDir: /workspace
      group:
        kind: build
        isDefault: false

  - id: terraform-apply
    exec:
      component: terraform
      commandLine: "terraform apply -auto-approve"
      workingDir: /workspace
      group:
        kind: build
        isDefault: false

  - id: terraform-lint
    exec:
      component: terraform-lint
      commandLine: "tflint"
      workingDir: /workspace
      group:
        kind: build
        isDefault: false

  - id: generate-docs
    exec:
      component: terraform-docs
      commandLine: "terraform-docs markdown ."
      workingDir: /workspace
      group:
        kind: build
        isDefault: false

volumes:
  - name: terraform-data
    ephemeral: true

